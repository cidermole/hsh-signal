import numpy as np


if __name__ == '__main__':
    test_sig = np.array([-0.52, -0.50248776, -0.496, -0.48946329, -0.47663404,
           -0.47956118, -0.49914683, -0.52697608, -0.54956174, -0.57622024,
           -0.588, -0.589, -0.58490211, -0.57656062, -0.56504783,
           -0.54775528, -0.52980423, -0.51919466, -0.50770634, -0.49053504,
           -0.46875528, -0.46641435, -0.4612436, -0.457, -0.46948943,
           -0.49134316, -0.50775751, -0.52405061, -0.53956174, -0.54104839,
           -0.53175528, -0.529, -0.52360845, -0.50946162, -0.49658398,
           -0.48109566, -0.46770634, -0.46236485, -0.4435584, -0.42136374,
           -0.41134038, -0.40700056, -0.41902781, -0.45273637, -0.48156396,
           -0.49905061, -0.502, -0.49294994, -0.49, -0.49436652,
           -0.48938821, -0.47487597, -0.46712125, -0.458901, -0.45155951,
           -0.447, -0.43875306, -0.42280256, -0.41319355, -0.408,
           -0.41273415, -0.43290823, -0.46110345, -0.49029867, -0.51463849,
           -0.53219689, -0.54153838, -0.545, -0.54077864, -0.53321858,
           -0.531, -0.53087709, -0.52111902, -0.517, -0.514,
           -0.50458231, -0.49107008, -0.47885261, -0.48295439, -0.50442214,
           -0.53827697, -0.5649822, -0.58700445, -0.60234372, -0.606,
           -0.604, -0.59563181, -0.58714516, -0.57389766, -0.55282202,
           -0.5305317, -0.51384872, -0.4978743, -0.48148276, -0.46789989,
           -0.4577792, -0.46156618, -0.47724917, -0.49566518, -0.52232647,
           -0.54114905, -0.55173582, -0.55416796, -0.55041324, -0.53845495,
           -0.52507175, -0.519901, -0.50892102, -0.49323804, -0.47755506,
           -0.46621802, -0.46109455, -0.44538265, -0.42782314, -0.41607008,
           -0.42090712, -0.44364516, -0.46888598, -0.48229588, -0.48531869,
           -0.49248943, -0.497, -0.5, -0.5, -0.49765517,
           -0.48362736, -0.46194438, -0.4506307, -0.44128921, -0.43089544,
           -0.41540934, -0.40026474, -0.397, -0.39941824, -0.41239933,
           -0.43425306, -0.45588543, -0.47356841, -0.48968854, -0.49846719,
           -0.50190434, -0.504, -0.50375417, -0.49716685, -0.48882536,
           -0.47796774, -0.46421357, -0.45880089, -0.4544594, -0.44611791,
           -0.43477642, -0.429, -0.43390656, -0.45274416, -0.47576863,
           -0.49832759, -0.52181758, -0.53822803, -0.54795551, -0.554,
           -0.54968076, -0.54251001, -0.53467853, -0.51967408, -0.50499333,
           -0.49686485, -0.51465628, -0.50094216, -0.48325918, -0.4742881,
           -0.47810679, -0.49718465, -0.52631368, -0.55823359, -0.58425806,
           -0.60440211, -0.61710234, -0.62122191, -0.621, -0.62,
           -0.6155317, -0.60619021, -0.59477308, -0.58150723, -0.56591435,
           -0.54606062, -0.52996552, -0.5152119, -0.51340044, -0.53335428,
           -0.55276641, -0.57728643, -0.60191546, -0.62081535, -0.63012458,
           -0.633, -0.63346607, -0.63563682, -0.62657731, -0.61208676,
           -0.60070189, -0.5873604, -0.56856618, -0.54569355, -0.53050389,
           -0.51599444, -0.511, -0.52237709, -0.54812013, -0.58517186,
           -0.61599555, -0.62802725, -0.629802, -0.62526251, -0.62453949,
           -0.625, -0.61723804, -0.60784483, -0.59533259, -0.57603393,
           -0.54692436, -0.51065295, -0.48728365, -0.47877141, -0.46925918,
           -0.462, -0.47494216, -0.46548165, -0.48364961, -0.50140267,
           -0.509, -0.508, -0.508, -0.508, -0.50118242,
           -0.4863743, -0.46970412, -0.45960011, -0.44281313, -0.42015128,
           -0.40108454, -0.38140156, -0.36903893, -0.3649822, -0.37797108,
           -0.40399555, -0.42801669, -0.44769633, -0.46672414, -0.47651557,
           -0.47768632, -0.48185706, -0.47197219, -0.46660289, -0.4555228,
           -0.43783982, -0.41502447, -0.39335539, -0.393, -0.38588487,
           -0.36742492, -0.36143548, -0.36794105, -0.39234205, -0.42461402,
           -0.45323749, -0.47409121, -0.49435595, -0.5, -0.5,
           -0.5, -0.5, -0.5, -0.4879327, -0.46251057,
           -0.4342703, -0.41474861, -0.40240712, -0.39653281, -0.39627586,
           -0.40461735, -0.42387653, -0.45475083, -0.48224638, -0.51094994,
           -0.53298721, -0.5426663, -0.548, -0.55744494, -0.57630923,
           -0.56441935, -0.55231313, -0.54356952, -0.52488654, -0.50740267,
           -0.49315072, -0.4779188, -0.478, -0.48076418, -0.50547553])

    from hsh_signal.heartseries import Series
    from hsh_signal.ppg import ppg_beatdetect_getrr
    test_ppg = Series(test_sig, fps=30.0)
    ppg = ppg_beatdetect_getrr(test_ppg)
    ppg_ref = ppg_beatdetect_getrr(test_ppg, type='regular')
    ppg_ref.tbeats += 1.0  # wtf TODO
    assert len(ppg.tbeats) > 1
    assert np.all(np.abs(np.diff(ppg_ref.tbeats - ppg.tbeats)) < 35e-3)
